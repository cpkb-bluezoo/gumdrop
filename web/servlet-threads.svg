<?xml version="1.0" encoding="UTF-8"?>
<!--
  This file is part of gumdrop.

  gumdrop is free software; you can redistribute it and/or modify
  it under the terms of the GNU Lesser General Public License as published by
  the Free Software Foundation; either version 2 of the License, or
  (at your option) any later version.
-->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 720" width="600" height="720">
  <defs>
    <style>
      .box { fill: #f8f9fa; stroke: #495057; stroke-width: 2; }
      .box-io { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; }
      .box-pipe { fill: #fff3e0; stroke: #f57c00; stroke-width: 2; }
      .box-servlet { fill: #e8f5e9; stroke: #388e3c; stroke-width: 2; }
      .arrow { fill: none; stroke: #495057; stroke-width: 2; marker-end: url(#arrowhead); }
      .label { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; font-size: 14px; fill: #212529; }
      .label-small { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; font-size: 11px; fill: #6c757d; }
      .label-title { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; font-size: 13px; fill: #495057; font-style: italic; }
      .section-label { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; font-size: 12px; fill: #868e96; font-weight: bold; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#495057" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="300" y="30" text-anchor="middle" class="label" style="font-size: 16px; font-weight: bold;">Servlet Container Request Flow</text>

  <!-- Section: Network Layer -->
  <text x="30" y="70" class="section-label">NETWORK</text>
  <line x1="30" y1="75" x2="570" y2="75" stroke="#dee2e6" stroke-width="1" />

  <!-- Client TCP Connection -->
  <rect x="175" y="90" width="250" height="45" rx="8" class="box" />
  <text x="300" y="118" text-anchor="middle" class="label">Client TCP Connection</text>

  <!-- Arrow -->
  <line x1="300" y1="135" x2="300" y2="170" class="arrow" />

  <!-- Section: I/O Layer -->
  <text x="30" y="195" class="section-label">I/O LAYER</text>
  <line x1="30" y1="200" x2="570" y2="200" stroke="#dee2e6" stroke-width="1" />

  <!-- AcceptSelectorLoop -->
  <rect x="125" y="215" width="350" height="55" rx="8" class="box-io" />
  <text x="300" y="238" text-anchor="middle" class="label" style="font-weight: bold;">AcceptSelectorLoop</text>
  <text x="300" y="258" text-anchor="middle" class="label-small">single thread, accepts all connections</text>

  <!-- Arrow with label -->
  <line x1="300" y1="270" x2="300" y2="320" class="arrow" />
  <text x="310" y="300" class="label-title">round-robin assignment</text>

  <!-- SelectorLoop -->
  <rect x="125" y="330" width="350" height="55" rx="8" class="box-io" />
  <text x="300" y="353" text-anchor="middle" class="label" style="font-weight: bold;">SelectorLoop</text>
  <text x="300" y="373" text-anchor="middle" class="label-small">I/O worker, handles read/write/SSL</text>

  <!-- Arrow with label -->
  <line x1="300" y1="385" x2="300" y2="435" class="arrow" />
  <text x="310" y="415" class="label-title">HTTP parsing, headers complete</text>

  <!-- Section: Pipe Layer -->
  <text x="30" y="460" class="section-label">PIPE LAYER</text>
  <line x1="30" y1="465" x2="570" y2="465" stroke="#dee2e6" stroke-width="1" />

  <!-- PipedOutputStream -->
  <rect x="125" y="480" width="350" height="45" rx="8" class="box-pipe" />
  <text x="300" y="508" text-anchor="middle" class="label" style="font-weight: bold;">PipedOutputStream</text>
  <text x="490" y="508" class="label-small">‚Üê request body</text>

  <!-- Arrow with label (pipe connection) -->
  <line x1="300" y1="525" x2="300" y2="565" class="arrow" />
  <text x="310" y="550" class="label-title">pipe connects layers</text>

  <!-- PipedInputStream -->
  <rect x="125" y="575" width="350" height="45" rx="8" class="box-pipe" />
  <text x="300" y="603" text-anchor="middle" class="label" style="font-weight: bold;">PipedInputStream</text>

  <!-- Arrow -->
  <line x1="300" y1="620" x2="300" y2="655" class="arrow" />

  <!-- Section: Servlet Layer -->
  <text x="30" y="640" class="section-label">SERVLET LAYER</text>
  <line x1="30" y1="645" x2="570" y2="645" stroke="#dee2e6" stroke-width="1" />

  <!-- Servlet Worker Thread -->
  <rect x="125" y="660" width="350" height="55" rx="8" class="box-servlet" />
  <text x="300" y="683" text-anchor="middle" class="label" style="font-weight: bold;">Servlet Worker Thread</text>
  <text x="300" y="703" text-anchor="middle" class="label-small">blocks on pipe, services request</text>

</svg>

